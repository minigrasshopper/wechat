!function(e,t){"function"==typeof define&&define.amd?define(function(){return t(e)}):"undefined"!=typeof module&&module.exports?module.exports=t(e):e.oAuth=t(e)}("undefined"!=typeof window?window:this,function(e){var t,o=(e.PROJECT_NAME="ng",e.KEY_API_TOKEN="wxapitoken"),n=e.KEY_API_OPENID="wxapiopenid",i="m_redirect",r=e.OAUTH_URL,a="CHECK_TOKEN_",c=10,u={cfg:function(i,c,u){var d=new Date,u=u||"snsapi_base";o=o+"_"+i+"_"+[d.getYear(),d.getMonth(),d.getDate()].join(""),n=n+"_"+i+"_"+[d.getYear(),d.getMonth(),d.getDate()].join(""),r=e.OAUTH_URL=c?"http://q.letwx.com/oauth/apitest?scope="+u+"&uid="+i+"&redirect=":1==i?"http://q.letwx.com/oauth/api?scope="+u+"&uid="+i+"&redirect=":"http://q.letwx.com/oauth/api?scope="+u+"&uid="+i+"&redirect=",a="CHECK_TOKEN_"+i,t=localStorage[a]||0},checkToken:function(u,d){var l,f,p=this,s=r+encodeURIComponent(e.location.href),g=p.getUrlParam(),h=e.location.href.split("&wxapiopenid")[0];h=h.split("&wxapitoken")[0],g.from?(h=h.split("&from")[0],h=h.split("?from")[0],s=r+encodeURIComponent(h)):(l=g.wxapitoken,f=g.wxapiopenid),l&&f?(p.setCookie(o,l),p.setCookie(n,f),u&&u(f,l)):p.getCookie(o)&&p.getCookie(n)?u&&u(p.getCookie(n),p.getCookie(o)):(p.setCookie(i,encodeURIComponent(h)),t++,localStorage[a]=t,c>t?setTimeout(function(){e.location.href=s},200):(delete localStorage[a],d&&d()))},getAuthId:function(){return this.getCookie(n)},getAuthToken:function(){return this.getCookie(o)},clear:function(){this.delCookie(o),this.delCookie(n)},getUrlParam:function(t){var o=t,n=0,i=null;for(o||(o=e.location.href),o=o.replace("#rd","");o.indexOf("#")>-1;){n=o.indexOf("#",n+1);var r=o.substr(n);i=r.indexOf("&")>-1?r.indexOf("&"):r.length,o=o.replace(o.substr(n,i),"")}var a=new Object;if(o.indexOf("?")>-1)for(var c=o.substr(o.indexOf("?")+1),u=c.split("&"),d=0;d<u.length;d++){var l=u[d].split("=");a[l[0]]=l[1]}return a},setCookie:function(e,t,o){var n=new Date;n.setDate(n.getDate()+o),document.cookie=e+"="+escape(t)+(null==o?"":";expires="+n.toGMTString())},getCookie:function(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?t[2]:null},delCookie:function(e){var t=new Date;t.setTime(t.getTime()-1);var o=this.getCookie(e);null!=o&&(document.cookie=e+"="+o+";expires="+t.toGMTString())}};return u});